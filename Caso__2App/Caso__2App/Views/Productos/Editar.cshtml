@* Views/Productos/Editar.cshtml *@
@{
    ViewBag.Title = "Editar Producto";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var id = ViewBag.Id ?? Request.RequestContext.RouteData.Values["id"];
}
<h2>Editar Producto</h2>

<form id="frmEdit" class="row g-3" data-id="@id">
    <div class="col-md-6">
        <label class="form-label">Nombre</label>
        <input class="form-control" id="Nombre" required maxlength="50">
    </div>
    <div class="col-md-6">
        <label class="form-label">Categoría</label>
        <select class="form-select" id="Categoria" required>
            <option value="">Seleccione</option>
            <option>Fútbol</option>
            <option>Básquetbol</option>
            <option>Natación</option>
            <option>Tenis</option>
        </select>
    </div>
    <div class="col-md-12">
        <label class="form-label">Descripción</label>
        <textarea class="form-control" id="Descripcion" maxlength="200"></textarea>
    </div>
    <div class="col-md-4">
        <label class="form-label">Precio</label>
        <input type="number" step="0.01" class="form-control" id="Precio" required>
    </div>
    <div class="col-md-4">
        <label class="form-label">Stock</label>
        <input type="number" class="form-control" id="Stock" required>
    </div>
    <div class="col-12 d-flex gap-2">
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
        @Html.ActionLink("Volver", "ListarProductos", null, new { @class = "btn btn-secondary" })
    </div>
</form>

@section scripts{
    <script>
const API_BASE = "https://localhost:44360/api/producto";
const id = $('#frmEdit').data('id');

function cargar(){
  $.getJSON(`${API_BASE}/obtenerid/${id}`)
    .done(p=>{
      $('#Nombre').val(p.Nombre);
      $('#Descripcion').val(p.Descripcion);
      $('#Precio').val(p.Precio);
      $('#Stock').val(p.Stock);
      $('#Categoria').val(p.Categoria);
    })
    .fail(()=>alert('No se pudo cargar el producto.'));
}

$('#frmEdit').on('submit', function(e){
  e.preventDefault();
  const body = {
    ID: id,
    Nombre: $('#Nombre').val().trim(),
    Descripcion: $('#Descripcion').val().trim(),
    Precio: parseFloat($('#Precio').val()),
    Stock: parseInt($('#Stock').val(),10),
    Categoria: $('#Categoria').val()
  };
  $.ajax({
    url: `${API_BASE}/actualizarproducto/${id}`,
    method: 'PUT',
    contentType: 'application/json',
    data: JSON.stringify(body)
  })
  .done(()=>window.location='@Url.Action("ListarProductos")')
  .fail(x=>{ console.error(x.responseText); alert('Error al actualizar.'); });
});

$(cargar);
    </script>
}
